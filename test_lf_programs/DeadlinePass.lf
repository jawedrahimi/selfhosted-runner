target C { timeout: 2 sec }

main reactor {
  reaction(startup) {=
    #include <stdio.h>
    #include <time.h>
    #include <unistd.h>
    #include <stdlib.h>

    struct timespec t0, t1;
    clock_gettime(CLOCK_MONOTONIC, &t0); // Saves the start timestamp

    usleep(50 * 1000); // 50 ms simulated work

    clock_gettime(CLOCK_MONOTONIC, &t1); // Saves the end timestamp

    long elapsed_ms =
      (t1.tv_sec - t0.tv_sec) * 1000 + // Convert seconds to milliseconds
      (t1.tv_nsec - t0.tv_nsec) / 1000000; // Convert nanoseconds to milliseconds

    long deadline_ms = 200; // Deadline in milliseconds (2 seconds)

    if (elapsed_ms <= deadline_ms) { // Check if the elapsed time meets the deadline
      printf("PASS: %ld ms <= %ld ms deadline\n", elapsed_ms, deadline_ms); // will exit with 0 if the deadline is met
      exit(0);
    } else {
      fprintf(stderr, "FAIL: %ld ms > %ld ms deadline\n", elapsed_ms, deadline_ms); // will exit with 1 if the deadline is missed
      exit(1);
    }
  =}
}
